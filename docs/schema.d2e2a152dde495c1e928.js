"use strict";(self.webpackChunkjson_utils=self.webpackChunkjson_utils||[]).push([[322],{105:(t,e,s)=>{s(546);var i=s(695),a=s(412),n=s(137),o=s(306);class l{constructor(){this.lastValidJSON=null,this.inferrer=new a.p,this.storageManager=new n.qe({key:n.d5.SCHEMA_DETECTOR,autoSave:!0,debounceMs:500}),this.initializeElements(),this.initializeEditors(),this.attachEventListeners(),this.loadSavedContent(),this.storageManager.setupSyncEnabledListener(()=>this.inputEditor.getValue())}initializeElements(){this.elements={clearBtn2:this.getElementById("clearBtn2"),loadSampleBtn:this.getElementById("loadSampleBtn"),copyBtn2:this.getElementById("copyBtn2"),downloadBtn2:this.getElementById("downloadBtn2"),inputStatus:this.getElementById("inputStatus"),outputStatus:this.getElementById("outputStatus"),schemaFormatRadios:document.querySelectorAll('input[name="schemaFormat"]')}}getElementById(t){const e=document.getElementById(t);if(!e)throw new Error(`Element with id "${t}" not found`);return e}initializeEditors(){const t=i.i.initializeEditor("jsonInput",{mode:"application/json",readOnly:!1});if(!t)throw new Error("Failed to initialize input editor");this.inputEditor=t,this.inputEditor.setOption("readOnly",!1),this.inputEditor.on("change",()=>{const t=this.inputEditor.getValue();this.storageManager.save(t),this.debounce(()=>this.validateInput(),500)()});const e=i.i.initializeEditor("output",{mode:"application/json",readOnly:!0});if(!e)throw new Error("Failed to initialize output editor");this.outputEditor=e}attachEventListeners(){this.elements.clearBtn2.addEventListener("click",()=>this.clearInput()),this.elements.loadSampleBtn.addEventListener("click",()=>this.loadSample()),this.elements.copyBtn2.addEventListener("click",()=>this.copyOutput()),this.elements.downloadBtn2.addEventListener("click",()=>this.downloadOutput()),this.elements.schemaFormatRadios.forEach(t=>{t.addEventListener("change",()=>{this.lastValidJSON&&this.inferSchema()})})}debounce(t,e){let s;return(...i)=>{clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),t(...i)},e)}}clearInput(){this.inputEditor.setValue(""),this.outputEditor.setValue(""),this.storageManager.clear(),this.clearStatus(),this.lastValidJSON=null}loadSample(){(0,o.Mh)("loadSampleBtn","Load Sample");const t=JSON.stringify({users:[{id:1,name:"Alice",email:"alice@example.com",role:"admin",active:!0,lastLogin:"2024-01-15T10:30:00Z"},{id:2,name:"Bob",email:"bob@example.com",role:"user",active:!0,lastLogin:"2024-01-14T15:45:00Z"},{id:3,name:"Charlie",email:"charlie@example.com",role:"user",active:!1,lastLogin:null}],metadata:{total:3,page:1,perPage:10}},null,2);this.inputEditor.setValue(t),this.validateInput()}validateInput(){const t=this.inputEditor.getValue().trim();if(!t)return this.clearStatus(),this.lastValidJSON=null,void this.outputEditor.setValue("");try{this.lastValidJSON=JSON.parse(t),this.showStatus(this.elements.inputStatus,"Valid JSON","success"),this.inferSchema()}catch(t){const e=t instanceof Error?t.message:"Unknown error";this.lastValidJSON=null,this.outputEditor.setValue(""),this.showStatus(this.elements.inputStatus,`Invalid JSON: ${e}`,"error")}}inferSchema(){if(this.lastValidJSON)try{const t=Array.from(this.elements.schemaFormatRadios).find(t=>t.checked)?.value||"simplified";let e,s;"jsonschema"===t?(e=this.inferrer.toJSONSchema(this.lastValidJSON),s=this.inferrer.formatSchema(e),this.showStatus(this.elements.outputStatus,"JSON Schema generated successfully","success")):(e=this.inferrer.inferSchema(this.lastValidJSON),s=this.inferrer.formatSchema(e),this.showStatus(this.elements.outputStatus,"Schema inferred successfully","success")),this.outputEditor.setValue(s),this.outputEditor.setOption("mode","application/json"),(0,o.aB)(t,this.inputEditor.getValue().length,!0)}catch(t){const e=t instanceof Error?t.message:"Unknown error";this.showStatus(this.elements.outputStatus,`Error inferring schema: ${e}`,"error"),(0,o.Oz)(o.Ur.JSON_PARSE_ERROR,e,"schema_inference")}else this.showStatus(this.elements.outputStatus,"Please enter valid JSON first","error")}async copyOutput(){const t=this.outputEditor.getValue();if(t)try{await navigator.clipboard.writeText(t),this.showStatus(this.elements.outputStatus,"Schema copied to clipboard!","success"),(0,o.NA)("schema",t.length)}catch(e){const s=document.createElement("textarea");s.value=t,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),this.showStatus(this.elements.outputStatus,"Schema copied to clipboard!","success"),(0,o.NA)("schema",t.length)}else this.showStatus(this.elements.outputStatus,"No schema to copy","error")}downloadOutput(){const t=this.outputEditor.getValue();if(!t)return void this.showStatus(this.elements.outputStatus,"No schema to download","error");const e="schema.json",s=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(s),a=document.createElement("a");a.href=i,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i),this.showStatus(this.elements.outputStatus,`Schema downloaded as ${e}`,"success"),(0,o.MH)("json",t.length)}showStatus(t,e,s){t.innerHTML="",t.className=`status-inline ${s}`,"error"===s&&t.classList.add("collapsed");const i=document.createElement("span");i.className="error-content",i.textContent=e,t.appendChild(i)}clearStatus(){this.elements.inputStatus.textContent="",this.elements.inputStatus.className="status-inline",this.elements.outputStatus.textContent="",this.elements.outputStatus.className="status-inline"}loadSavedContent(){const t=this.storageManager.load();t&&t.trim()&&(this.inputEditor.setValue(t),this.validateInput())}}async function r(){await Promise.all([Promise.resolve().then(s.t.bind(s,792,23)),Promise.resolve().then(s.t.bind(s,948,23)),Promise.resolve().then(s.t.bind(s,274,23)),Promise.resolve().then(s.t.bind(s,795,23))])}const u=async()=>{document.getElementById("jsonInput")&&("requestIdleCallback"in window?requestIdleCallback(async()=>{await r(),new l},{timeout:2e3}):setTimeout(async()=>{await r(),new l},0))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u()},546:()=>{}},t=>{t.O(0,[272,604,96,715,363],()=>t(t.s=105)),t.O()}]);