"use strict";(self.webpackChunkjson_utils=self.webpackChunkjson_utils||[]).push([[322],{105:(t,e,s)=>{s(546);var i=s(695),r=s(412);class n{constructor(){this.lastValidJSON=null,this.inferrer=new r.p,this.initializeElements(),this.initializeEditors(),this.attachEventListeners()}initializeElements(){this.elements={clearBtn2:this.getElementById("clearBtn2"),loadSampleBtn:this.getElementById("loadSampleBtn"),copyBtn2:this.getElementById("copyBtn2"),downloadBtn2:this.getElementById("downloadBtn2"),inputStatus:this.getElementById("inputStatus"),outputStatus:this.getElementById("outputStatus"),schemaFormatRadios:document.querySelectorAll('input[name="schemaFormat"]')}}getElementById(t){const e=document.getElementById(t);if(!e)throw new Error(`Element with id "${t}" not found`);return e}initializeEditors(){const t=i.i.initializeEditor("jsonInput",{mode:"application/json",readOnly:!1});if(!t)throw new Error("Failed to initialize input editor");this.inputEditor=t,this.inputEditor.setOption("readOnly",!1),this.inputEditor.on("change",()=>{this.debounce(()=>this.validateInput(),500)()});const e=i.i.initializeEditor("output",{mode:"application/json",readOnly:!0});if(!e)throw new Error("Failed to initialize output editor");this.outputEditor=e}attachEventListeners(){this.elements.clearBtn2.addEventListener("click",()=>this.clearInput()),this.elements.loadSampleBtn.addEventListener("click",()=>this.loadSample()),this.elements.copyBtn2.addEventListener("click",()=>this.copyOutput()),this.elements.downloadBtn2.addEventListener("click",()=>this.downloadOutput()),this.elements.schemaFormatRadios.forEach(t=>{t.addEventListener("change",()=>{this.lastValidJSON&&this.inferSchema()})})}debounce(t,e){let s;return(...i)=>{clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),t(...i)},e)}}clearInput(){this.inputEditor.setValue(""),this.outputEditor.setValue(""),this.clearStatus(),this.lastValidJSON=null}loadSample(){const t=JSON.stringify({users:[{id:1,name:"Alice",email:"alice@example.com",role:"admin",active:!0,lastLogin:"2024-01-15T10:30:00Z"},{id:2,name:"Bob",email:"bob@example.com",role:"user",active:!0,lastLogin:"2024-01-14T15:45:00Z"},{id:3,name:"Charlie",email:"charlie@example.com",role:"user",active:!1,lastLogin:null}],metadata:{total:3,page:1,perPage:10}},null,2);this.inputEditor.setValue(t),this.validateInput()}validateInput(){const t=this.inputEditor.getValue().trim();if(!t)return this.clearStatus(),this.lastValidJSON=null,void this.outputEditor.setValue("");try{this.lastValidJSON=JSON.parse(t),this.showStatus(this.elements.inputStatus,"Valid JSON","success"),this.inferSchema()}catch(t){const e=t instanceof Error?t.message:"Unknown error";this.lastValidJSON=null,this.outputEditor.setValue(""),this.showStatus(this.elements.inputStatus,`Invalid JSON: ${e}`,"error")}}inferSchema(){if(this.lastValidJSON)try{let t,e;"jsonschema"===(Array.from(this.elements.schemaFormatRadios).find(t=>t.checked)?.value||"simplified")?(t=this.inferrer.toJSONSchema(this.lastValidJSON),e=this.inferrer.formatSchema(t),this.showStatus(this.elements.outputStatus,"JSON Schema generated successfully","success")):(t=this.inferrer.inferSchema(this.lastValidJSON),e=this.inferrer.formatSchema(t),this.showStatus(this.elements.outputStatus,"Schema inferred successfully","success")),this.outputEditor.setValue(e),this.outputEditor.setOption("mode","application/json")}catch(t){const e=t instanceof Error?t.message:"Unknown error";this.showStatus(this.elements.outputStatus,`Error inferring schema: ${e}`,"error")}else this.showStatus(this.elements.outputStatus,"Please enter valid JSON first","error")}async copyOutput(){const t=this.outputEditor.getValue();if(t)try{await navigator.clipboard.writeText(t),this.showStatus(this.elements.outputStatus,"Schema copied to clipboard!","success")}catch(e){const s=document.createElement("textarea");s.value=t,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),this.showStatus(this.elements.outputStatus,"Schema copied to clipboard!","success")}else this.showStatus(this.elements.outputStatus,"No schema to copy","error")}downloadOutput(){const t=this.outputEditor.getValue();if(!t)return void this.showStatus(this.elements.outputStatus,"No schema to download","error");const e="schema.json",s=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(s),r=document.createElement("a");r.href=i,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),this.showStatus(this.elements.outputStatus,`Schema downloaded as ${e}`,"success")}showStatus(t,e,s){t.innerHTML="",t.className=`status-inline ${s}`,"error"===s&&t.classList.add("collapsed");const i=document.createElement("span");i.className="error-content",i.textContent=e,t.appendChild(i)}clearStatus(){this.elements.inputStatus.textContent="",this.elements.inputStatus.className="status-inline",this.elements.outputStatus.textContent="",this.elements.outputStatus.className="status-inline"}}async function a(){await Promise.all([Promise.resolve().then(s.t.bind(s,792,23)),Promise.resolve().then(s.t.bind(s,948,23)),Promise.resolve().then(s.t.bind(s,274,23)),Promise.resolve().then(s.t.bind(s,795,23))])}const o=async()=>{document.getElementById("jsonInput")&&("requestIdleCallback"in window?requestIdleCallback(async()=>{await a(),new n},{timeout:2e3}):setTimeout(async()=>{await a(),new n},0))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o()},412:(t,e,s)=>{s.d(e,{p:()=>r});const i=s(683);class r{toJSONSchema(t){const e=i(t,{required:!0,arrays:{mode:"first"},strings:{detectFormat:!1},postProcessFnc:(t,e,s)=>("number"===t&&Number.isInteger(s)&&(e.type="integer"),e)});return this.enrichArraySchemas(e,t)}isDictionaryPattern(t){if(!t||"object"!=typeof t||Array.isArray(t))return!1;const e=Object.keys(t);if(e.length<2)return!1;const s=t[e[0]];if(!s||"object"!=typeof s||Array.isArray(s))return!1;const i=JSON.stringify(this.getValueSchema(s));for(let s=1;s<e.length;s++){const r=t[e[s]];if(!r||"object"!=typeof r||Array.isArray(r))return!1;if(JSON.stringify(this.getValueSchema(r))!==i)return!1}return!0}getValueSchema(t){if(null===t)return{type:"null"};if(Array.isArray(t))return{type:"array"};const e=typeof t;return"object"===e?{type:"object",keys:Object.keys(t).sort()}:{type:e}}enrichArraySchemas(t,e){if(!t||"object"!=typeof t)return t;if("object"===t.type&&t.properties&&this.isDictionaryPattern(e)){const t=e[Object.keys(e)[0]],s=i(t,{required:!0,strings:{detectFormat:!1}});return{type:"object",additionalProperties:this.enrichArraySchemas(s,t)}}if("array"===t.type&&t.items&&Array.isArray(e)&&e.length>0){if("object"==typeof e[0]&&null!==e[0]&&!Array.isArray(e[0])){const s=new Set,r={};for(const t of e)"object"==typeof t&&null!==t&&Object.keys(t).forEach(t=>s.add(t));for(const t of s){const s=e.filter(e=>"object"==typeof e&&null!==e&&t in e).map(e=>e[t]);if(s.length>0&&(r[t]=i(s[0],{required:!0,strings:{detectFormat:!1}}),e.some(e=>"object"==typeof e&&null!==e&&null===e[t]))){const e=r[t].type;r[t].type=Array.isArray(e)?[...e,"null"]:[e,"null"]}}t.items={type:"object",properties:r,required:Array.from(s)}}t.items&&(t.items=this.enrichArraySchemas(t.items,e[0]))}if("object"===t.type&&t.properties)for(const[s,i]of Object.entries(t.properties))e&&"object"==typeof e&&s in e&&(t.properties[s]=this.enrichArraySchemas(i,e[s]));return t}inferSchema(t){const e=this.toJSONSchema(t);return this.jsonSchemaToSimple(e)}jsonSchemaToSimple(t){if(!t||"object"!=typeof t)return"any";const e=t.type;if(Array.isArray(e))return e.map(t=>this.typeToSimple(t)).join(" | ");if("object"===e){if(t.additionalProperties&&!t.properties)return{"[key: string]":this.jsonSchemaToSimple(t.additionalProperties)};if(t.properties){const e={};for(const[s,i]of Object.entries(t.properties))e[s]=this.jsonSchemaToSimple(i);return e}return"Object"}if("array"===e&&t.items){const e=this.jsonSchemaToSimple(t.items);return"object"!=typeof e||Array.isArray(e)?`Array<${e}>`:[e]}return this.typeToSimple(e)}typeToSimple(t){switch(t){case"string":return"String";case"number":return"Number";case"integer":return"Integer";case"boolean":return"Boolean";case"null":return"null";case"object":return"Object";case"array":return"Array";default:return t}}formatSchema(t,e=2){return JSON.stringify(t,null,e)}}},546:()=>{},695:(t,e,s)=>{s.d(e,{i:()=>r});var i=s(237);s(792),s(923),s(948),s(274),s(795),s(402),s(347),s(974);class r{static initializeEditor(t,e={}){const s=document.getElementById(t);if(!s)return console.error(`Textarea with id "${t}" not found`),null;if(s.CodeMirror){console.warn(`CodeMirror already initialized on textarea "${t}", returning existing instance`);const e=s.CodeMirror;return this.instances.set(t,e),e}const r=this.instances.get(t);if(r)return console.warn(`CodeMirror instance already exists for "${t}", returning existing instance`),r;try{const r={mode:"application/json",theme:"material-darker",lineNumbers:!0,lineWrapping:!0,readOnly:!1,indentUnit:2,tabSize:2,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],matchBrackets:!0,extraKeys:{"Ctrl-Q":t=>t.foldCode(t.getCursor()),"Cmd-Q":t=>t.foldCode(t.getCursor())},...e},n=i.fromTextArea(s,r);return this.instances.set(t,n),n}catch(e){return console.error(`Failed to initialize CodeMirror on textarea "${t}":`,e),null}}static getInstance(t){return this.instances.get(t)||null}static cleanup(t){const e=this.instances.get(t);if(e)try{e.toTextArea(),this.instances.delete(t)}catch(e){console.error(`Error cleaning up CodeMirror instance for "${t}":`,e)}}static cleanupAll(){for(const[t]of this.instances)this.cleanup(t)}static hasInstance(t){const e=document.getElementById(t);return!(!e||!e.CodeMirror)||this.instances.has(t)}}r.instances=new Map}},t=>{t.O(0,[272,604,96,715],()=>t(t.s=105)),t.O()}]);